<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Drilldown Prototype (Checkbox-only + Table + Chips)</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }

    .row { display: flex; gap: 20px; margin-bottom: 10px; }
    .stage {
      width: 450px; height: 150px;
      border: 1px solid #ccc; border-radius: 6px;
      padding: 10px; overflow-y: auto; background: #fff;
    }
    .stage.disabled { background: #f5f5f5; color: #888; text-align: center; font-style: italic; }
    .stage label.title { font-weight: bold; display: block; margin-bottom: 4px; }
    .group { margin: 4px 0; }

    /* Divider */
    hr { border: none; border-top: 2px solid #ccc; margin: 20px 0; width: 100%; max-width: 1500px; }

    /* Breadcrumbs */
    .breadcrumbs { display: flex; align-items: center; gap: 6px; font-size: 0.95em; margin: 12px 0 8px 0; width: 100%; max-width: 1500px; }
    .breadcrumbs a { color: #0073e6; text-decoration: none; cursor: pointer; }
    .breadcrumbs a:hover { text-decoration: underline; }
    .breadcrumbs .separator { color: #888; }
    .breadcrumbs .current { font-weight: bold; }

    /* Chips */
    .filters { display: flex; flex-wrap: wrap; gap: 6px; margin-bottom: 16px; width: 100%; max-width: 1500px; }
    .chip {
      display: inline-flex; align-items: center;
      padding: 4px 10px; border-radius: 16px;
      background: #e6f0ff; color: #004080;
      font-size: 0.9em;
    }
    .chip button {
      border: none; background: none; margin-left: 6px;
      cursor: pointer; color: #004080; font-weight: bold; font-size: 1em; line-height: 1;
    }
    .chip button:hover { color: #c00; }

    /* Chart */
    .chart {
      width: 100%; max-width: 1500px;
      height: 300px; border: 2px dashed #ccc; border-radius: 6px;
      display: flex; justify-content: center; align-items: center; color: #888;
      margin: 0 0 20px 0;
    }

    /* Table */
    .table-container { width: 100%; max-width: 1500px; margin: 0; }
    table { border-collapse: collapse; width: 100%; }
    th, td { border: 1px solid #ccc; padding: 8px; }
    td { cursor: pointer; }
    td:hover { background: #f0f8ff; }
  </style>
</head>
<body>

  <!-- Progressive Disclosure -->
  <div class="row">
    <div>
      <label class="title">Regions</label>
      <div class="stage" id="regionsStage"></div>
    </div>
    <div>
      <label class="title">Districts</label>
      <div class="stage" id="districtsStage"></div>
    </div>
    <div>
      <label class="title">Schools</label>
      <div class="stage" id="schoolsStage"></div>
    </div>
  </div>

  <!-- Divider -->
  <hr />

  <!-- Breadcrumbs -->
  <div class="breadcrumbs" id="breadcrumbs"></div>

  <!-- Filter Chips -->
  <div class="filters" id="filters">
    <div class="chip" data-filter="grade">Grade 8 <button>&times;</button></div>
    <div class="chip" data-filter="subject">Math <button>&times;</button></div>
  </div>

  <!-- Chart -->
  <div class="chart" id="chart">[Line Chart Here]</div>

  <!-- Table -->
  <div class="table-container">
    <h3>Selected Orgs</h3>
    <table id="orgTable">
      <thead><tr><th>Name</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const data = {
    north: { "Lincoln District": ["School A", "School B"], "Jefferson District": ["School C"] },
    south: { "Roosevelt District": ["School D", "School E"], "Madison District": ["School F"] }
  };

  const stages = {
    region: document.getElementById("regionsStage"),
    district: document.getElementById("districtsStage"),
    school: document.getElementById("schoolsStage")
  };
  const breadcrumbs = document.getElementById("breadcrumbs");
  const chart = document.getElementById("chart");
  const orgTable = document.querySelector("#orgTable tbody");

  let state = { regions: [], districts: [], schools: [] };

  function makeOption(level, value, label, container, preserveSelected, isSelectAll = false) {
    const div = document.createElement("div");
    div.className = "group";
    const input = document.createElement("input");
    input.type = "checkbox";
    if (isSelectAll) {
      input.classList.add("select-all");
      input.name = `${level}_selectall`;
    } else {
      input.name = `${level}_${value}`;
    }
    input.value = value;
    if (!isSelectAll && preserveSelected.includes(value)) input.checked = true;
    const lbl = document.createElement("label");
    lbl.textContent = label;
    lbl.style.marginLeft = "6px";
    div.appendChild(input);
    div.appendChild(lbl);
    container.appendChild(div);
    return input;
  }

  function buildRegions() {
    const preserved = [...state.regions];
    stages.region.innerHTML = "";
    makeOption("region", "ALL", "Select All", stages.region, [], true);
    for (const r in data) makeOption("region", r, r.toUpperCase(), stages.region, preserved);
    updateDistricts();
    updateSelectAll(stages.region);
  }

  function updateDistricts() {
    const preserved = [...state.districts];
    stages.district.innerHTML = "";
    stages.school.innerHTML = "";
    const selectedRegions = Array.from(stages.region.querySelectorAll("input[type=checkbox]:checked:not(.select-all)")).map(cb => cb.value);
    state.regions = selectedRegions;

    if (selectedRegions.length > 1) {
      stages.district.classList.add("disabled");
      stages.district.textContent = "Disabled while multiple Regions are selected";
      return;
    }
    stages.district.classList.remove("disabled");

    if (selectedRegions.length === 1) {
      makeOption("district", "ALL", "Select All", stages.district, [], true);
      for (const d in data[selectedRegions[0]]) makeOption("district", d, d, stages.district, preserved);
    }
    updateSchools();
    updateSelectAll(stages.district);
  }

  function updateSchools() {
    const preserved = [...state.schools];
    stages.school.innerHTML = "";
    const selectedDistricts = Array.from(stages.district.querySelectorAll("input[type=checkbox]:checked:not(.select-all)")).map(cb => cb.value);
    state.districts = selectedDistricts;

    if (selectedDistricts.length > 1) {
      stages.school.classList.add("disabled");
      stages.school.textContent = "Disabled while multiple Districts are selected";
      return;
    }
    stages.school.classList.remove("disabled");

    if (state.regions.length === 1 && selectedDistricts.length === 1) {
      makeOption("school", "ALL", "Select All", stages.school, [], true);
      data[state.regions[0]][selectedDistricts[0]].forEach(s => makeOption("school", s, s, stages.school, preserved));
    }
    updateSelectAll(stages.school);
  }

  function renderBreadcrumbs() {
    breadcrumbs.innerHTML = "";
    const root = document.createElement("a");
    root.href = "#"; root.dataset.level = "all"; root.textContent = "All Districts";
    breadcrumbs.appendChild(root);

    if (state.regions.length === 1) { breadcrumbs.appendChild(sep()); breadcrumbs.appendChild(document.createTextNode(state.regions[0].toUpperCase())); }
    else if (state.regions.length > 1) { breadcrumbs.appendChild(sep()); breadcrumbs.appendChild(document.createTextNode(`${state.regions.length} Regions`)); }

    if (state.districts.length === 1) { breadcrumbs.appendChild(sep()); breadcrumbs.appendChild(document.createTextNode(state.districts[0])); }
    else if (state.districts.length > 1) { breadcrumbs.appendChild(sep()); breadcrumbs.appendChild(document.createTextNode(`${state.districts.length} Districts`)); }

    if (state.schools.length === 1) { breadcrumbs.appendChild(sep()); breadcrumbs.appendChild(document.createTextNode(state.schools[0])); }
    else if (state.schools.length > 1) { breadcrumbs.appendChild(sep()); breadcrumbs.appendChild(document.createTextNode(`${state.schools.length} Schools`)); }
  }
  function sep(){ const s=document.createElement("span"); s.className="separator"; s.textContent="â€º"; return s; }

  function renderTable() {
    orgTable.innerHTML = "";
    let rows = [];
    if (state.schools.length > 0) rows = state.schools;
    else if (state.districts.length > 0) rows = state.districts;
    else if (state.regions.length > 0) rows = state.regions;

    rows.forEach(r => {
      const tr = document.createElement("tr");
      const td = document.createElement("td");
      td.textContent = r;
      td.addEventListener("click", () => handleDrilldown(r));
      tr.appendChild(td);
      orgTable.appendChild(tr);
    });
  }

  function handleDrilldown(orgName) {
    if (state.districts.includes(orgName)) {
      state.districts = [orgName];
      state.schools = data[state.regions[0]][orgName];
    }
    renderBreadcrumbs();
    renderTable();
    chart.textContent = `[Chart updated for drilldown into ${orgName}]`;
  }

  function updateSelectAll(container) {
    const selectAll = container.querySelector(".select-all");
    if (!selectAll) return;
    const children = container.querySelectorAll("input[type=checkbox]:not(.select-all)");
    const checked = Array.from(children).filter(cb => cb.checked);
    selectAll.checked = checked.length === children.length && children.length > 0;
    selectAll.indeterminate = checked.length > 0 && checked.length < children.length;
  }

  document.body.addEventListener("change", e => {
    if (e.target.classList.contains("select-all")) {
      const container = e.target.closest(".stage");
      container.querySelectorAll("input[type=checkbox]:not(.select-all)").forEach(cb => cb.checked = e.target.checked);
    }

    state.regions  = Array.from(stages.region.querySelectorAll("input[type=checkbox]:checked:not(.select-all)")).map(cb => cb.value);
    state.districts= Array.from(stages.district.querySelectorAll("input[type=checkbox]:checked:not(.select-all)")).map(cb => cb.value);
    state.schools  = Array.from(stages.school.querySelectorAll("input[type=checkbox]:checked:not(.select-all)")).map(cb => cb.value);

    updateDistricts();
    updateSchools();
    renderBreadcrumbs();
    renderTable();
    chart.textContent = `[Chart updated for scope: ${JSON.stringify(state)}]`;

    updateSelectAll(stages.region);
    updateSelectAll(stages.district);
    updateSelectAll(stages.school);
  });

  // Init
  buildRegions();
  renderBreadcrumbs();
  renderTable();
});
</script>
</body>
</html>
